\hypertarget{bms_8cpp}{}\doxysection{bms.\+cpp File Reference}
\label{bms_8cpp}\index{bms.cpp@{bms.cpp}}
{\ttfamily \#include $<$SPI.\+h$>$}\newline
{\ttfamily \#include \char`\"{}config.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bms.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint16\+\_\+t \mbox{\hyperlink{bms_8cpp_a62bd2c15a1dc8c3f754489a531047d27}{pec15\+\_\+calc}} (uint8\+\_\+t len, uint8\+\_\+t $\ast$data)
\begin{DoxyCompactList}\small\item\em Compute PEC. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_aa9f42a61cc56ebbed9c2b2eed9c4d818}{wakeup\+\_\+idle}} ()
\begin{DoxyCompactList}\small\item\em Wakes up from idle ltc6811. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_aeacc77d4d9999b2af8996090a8d6a189}{wakeup\+\_\+sleep}} ()
\begin{DoxyCompactList}\small\item\em Wakes up from sleep ltc6811. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a09984e66f76daff6f7eb71b9dcaa748e}{init\+\_\+slaves\+\_\+struct}} ()
\begin{DoxyCompactList}\small\item\em Initializes slaves struct. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a78925be3fd486c31a642cd7a3d77d41f}{init\+\_\+slaves\+\_\+cfg}} ()
\begin{DoxyCompactList}\small\item\em Initializes slaves configuration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a651c1e82545d6a604daccd2c4b80b86a}{write\+\_\+slaves\+\_\+cfg}} ()
\begin{DoxyCompactList}\small\item\em Write slaves configuration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_af287f77358bffec22416158c02e091c3}{start\+\_\+adcv}} ()
\begin{DoxyCompactList}\small\item\em Starts ADC voltages conversion. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_af473e260d65c8f954ff772c22998147b}{read\+\_\+voltages}} ()
\begin{DoxyCompactList}\small\item\em Read all slaves voltages. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a5e8045c9c746b1d5ad7dede824d22c81}{save\+\_\+voltages}} (uint8\+\_\+t slave\+\_\+idx, uint8\+\_\+t reg, uint8\+\_\+t $\ast$raw\+\_\+voltages)
\begin{DoxyCompactList}\small\item\em Saves slave voltages. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a3efbba2ca7c752bc6ec6df3107650df0}{read\+\_\+temperatures}} ()
\begin{DoxyCompactList}\small\item\em Read all slaves temperatures. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a83cdd97ba3d37a0366ca43cd65fbc7ab}{save\+\_\+temperatures}} (uint8\+\_\+t slave\+\_\+idx, uint8\+\_\+t reg, uint8\+\_\+t $\ast$raw\+\_\+temperatures)
\begin{DoxyCompactList}\small\item\em Saves slave temperatures. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{bms_8cpp_a18f66bd8dd798c0cd1f847575a06c495}{print\+\_\+slaves}} ()
\begin{DoxyCompactList}\small\item\em Print slave info. \end{DoxyCompactList}\item 
uint16\+\_\+t \mbox{\hyperlink{bms_8cpp_a0da3f8eb3049bcf91d0640e33fb50ecd}{parse\+\_\+temperatures}} (uint16\+\_\+t temperature)
\begin{DoxyCompactList}\small\item\em Parses temperature. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
uint8\+\_\+t \mbox{\hyperlink{bms_8cpp_a35ec6d306f657f09635404cb28835f54}{slaves\+\_\+config}} \mbox{[}\mbox{\hyperlink{bms_8h_a8bf6169d30bbeede2c2c0c47ea1bdd83}{CFG\+\_\+\+LEN}}\mbox{]} = \{\}
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{struct_slave}{Slave}} configuration. \end{DoxyCompactList}\item 
\mbox{\hyperlink{struct_slave}{Slave}} \mbox{\hyperlink{bms_8cpp_a8da52d3cf3bf83854501719af98ab0e4}{slaves}} \mbox{[}\mbox{\hyperlink{config_8h_a9d3dfaea3b1a9a8e8307c02ce7a0acf0}{SLAVE\+\_\+\+NUM}}\mbox{]}
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{struct_slave}{Slave}} array. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{bms_8cpp_a78925be3fd486c31a642cd7a3d77d41f}\label{bms_8cpp_a78925be3fd486c31a642cd7a3d77d41f}} 
\index{bms.cpp@{bms.cpp}!init\_slaves\_cfg@{init\_slaves\_cfg}}
\index{init\_slaves\_cfg@{init\_slaves\_cfg}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{init\_slaves\_cfg()}{init\_slaves\_cfg()}}
{\footnotesize\ttfamily void init\+\_\+slaves\+\_\+cfg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initializes slaves configuration. 

Every ltc6811 needs a configuration to be written. \begin{DoxySeeAlso}{See also}
README -\/\texorpdfstring{$>$}{>} Codice \texorpdfstring{$>$}{>} Configurazione 
\end{DoxySeeAlso}
\mbox{\Hypertarget{bms_8cpp_a09984e66f76daff6f7eb71b9dcaa748e}\label{bms_8cpp_a09984e66f76daff6f7eb71b9dcaa748e}} 
\index{bms.cpp@{bms.cpp}!init\_slaves\_struct@{init\_slaves\_struct}}
\index{init\_slaves\_struct@{init\_slaves\_struct}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{init\_slaves\_struct()}{init\_slaves\_struct()}}
{\footnotesize\ttfamily void init\+\_\+slaves\+\_\+struct (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initializes slaves struct. 

Slaves are stored as Struct, this method initialize the data structure \mbox{\Hypertarget{bms_8cpp_a0da3f8eb3049bcf91d0640e33fb50ecd}\label{bms_8cpp_a0da3f8eb3049bcf91d0640e33fb50ecd}} 
\index{bms.cpp@{bms.cpp}!parse\_temperatures@{parse\_temperatures}}
\index{parse\_temperatures@{parse\_temperatures}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{parse\_temperatures()}{parse\_temperatures()}}
{\footnotesize\ttfamily uint16\+\_\+t parse\+\_\+temperatures (\begin{DoxyParamCaption}\item[{uint16\+\_\+t}]{temperature }\end{DoxyParamCaption})}



Parses temperature. 

Converts voltage drop to temperature using the P9-\/\+JT thermistor and 4Â° grade polynomial fit


\begin{DoxyParams}{Parameters}
{\em temperature} & temperature to convert \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
uint16\+\_\+t parsed temperature 
\end{DoxyReturn}
\mbox{\Hypertarget{bms_8cpp_a62bd2c15a1dc8c3f754489a531047d27}\label{bms_8cpp_a62bd2c15a1dc8c3f754489a531047d27}} 
\index{bms.cpp@{bms.cpp}!pec15\_calc@{pec15\_calc}}
\index{pec15\_calc@{pec15\_calc}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{pec15\_calc()}{pec15\_calc()}}
{\footnotesize\ttfamily uint16\+\_\+t pec15\+\_\+calc (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{len,  }\item[{uint8\+\_\+t $\ast$}]{data }\end{DoxyParamCaption})}



Compute PEC. 

Computes PEC15 code \mbox{\Hypertarget{bms_8cpp_a18f66bd8dd798c0cd1f847575a06c495}\label{bms_8cpp_a18f66bd8dd798c0cd1f847575a06c495}} 
\index{bms.cpp@{bms.cpp}!print\_slaves@{print\_slaves}}
\index{print\_slaves@{print\_slaves}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{print\_slaves()}{print\_slaves()}}
{\footnotesize\ttfamily void print\+\_\+slaves (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Print slave info. 

User readable voltages and temperatures \mbox{\Hypertarget{bms_8cpp_a3efbba2ca7c752bc6ec6df3107650df0}\label{bms_8cpp_a3efbba2ca7c752bc6ec6df3107650df0}} 
\index{bms.cpp@{bms.cpp}!read\_temperatures@{read\_temperatures}}
\index{read\_temperatures@{read\_temperatures}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{read\_temperatures()}{read\_temperatures()}}
{\footnotesize\ttfamily void read\+\_\+temperatures (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Read all slaves temperatures. 

Iterate over each slave and read stored temperatures \mbox{\Hypertarget{bms_8cpp_af473e260d65c8f954ff772c22998147b}\label{bms_8cpp_af473e260d65c8f954ff772c22998147b}} 
\index{bms.cpp@{bms.cpp}!read\_voltages@{read\_voltages}}
\index{read\_voltages@{read\_voltages}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{read\_voltages()}{read\_voltages()}}
{\footnotesize\ttfamily void read\+\_\+voltages (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Read all slaves voltages. 

Iterate over each slave and read register group N stored voltage \mbox{\Hypertarget{bms_8cpp_a83cdd97ba3d37a0366ca43cd65fbc7ab}\label{bms_8cpp_a83cdd97ba3d37a0366ca43cd65fbc7ab}} 
\index{bms.cpp@{bms.cpp}!save\_temperatures@{save\_temperatures}}
\index{save\_temperatures@{save\_temperatures}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{save\_temperatures()}{save\_temperatures()}}
{\footnotesize\ttfamily void save\+\_\+temperatures (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{address,  }\item[{uint8\+\_\+t}]{reg,  }\item[{uint8\+\_\+t $\ast$}]{raw\+\_\+temperatures }\end{DoxyParamCaption})}



Saves slave temperatures. 


\begin{DoxyParams}{Parameters}
{\em address} & slave address \\
\hline
{\em reg} & register where temperatures are stored \\
\hline
{\em raw\+\_\+temperatures} & pointer where temperatures will be stored \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{bms_8cpp_a5e8045c9c746b1d5ad7dede824d22c81}\label{bms_8cpp_a5e8045c9c746b1d5ad7dede824d22c81}} 
\index{bms.cpp@{bms.cpp}!save\_voltages@{save\_voltages}}
\index{save\_voltages@{save\_voltages}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{save\_voltages()}{save\_voltages()}}
{\footnotesize\ttfamily void save\+\_\+voltages (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{address,  }\item[{uint8\+\_\+t}]{reg,  }\item[{uint8\+\_\+t $\ast$}]{raw\+\_\+voltages }\end{DoxyParamCaption})}



Saves slave voltages. 


\begin{DoxyParams}{Parameters}
{\em address} & slave address \\
\hline
{\em reg} & register group where voltages are stored \\
\hline
{\em raw\+\_\+voltages} & pointer where voltages will be stored \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{bms_8cpp_af287f77358bffec22416158c02e091c3}\label{bms_8cpp_af287f77358bffec22416158c02e091c3}} 
\index{bms.cpp@{bms.cpp}!start\_adcv@{start\_adcv}}
\index{start\_adcv@{start\_adcv}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{start\_adcv()}{start\_adcv()}}
{\footnotesize\ttfamily void start\+\_\+adcv (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Starts ADC voltages conversion. 

Converts from analog to digital cells voltage \begin{DoxySeeAlso}{See also}
Read \char`\"{}\+ADCV\char`\"{} command in datasheet 
\end{DoxySeeAlso}
\mbox{\Hypertarget{bms_8cpp_aa9f42a61cc56ebbed9c2b2eed9c4d818}\label{bms_8cpp_aa9f42a61cc56ebbed9c2b2eed9c4d818}} 
\index{bms.cpp@{bms.cpp}!wakeup\_idle@{wakeup\_idle}}
\index{wakeup\_idle@{wakeup\_idle}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{wakeup\_idle()}{wakeup\_idle()}}
{\footnotesize\ttfamily void wakeup\+\_\+idle (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Wakes up from idle ltc6811. 

This method guarantees that the ltc6811 is not \char`\"{}idle\char`\"{} \mbox{\Hypertarget{bms_8cpp_aeacc77d4d9999b2af8996090a8d6a189}\label{bms_8cpp_aeacc77d4d9999b2af8996090a8d6a189}} 
\index{bms.cpp@{bms.cpp}!wakeup\_sleep@{wakeup\_sleep}}
\index{wakeup\_sleep@{wakeup\_sleep}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{wakeup\_sleep()}{wakeup\_sleep()}}
{\footnotesize\ttfamily void wakeup\+\_\+sleep (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Wakes up from sleep ltc6811. 

This method guarantees that the ltc6811 is not \char`\"{}sleep\char`\"{} \mbox{\Hypertarget{bms_8cpp_a651c1e82545d6a604daccd2c4b80b86a}\label{bms_8cpp_a651c1e82545d6a604daccd2c4b80b86a}} 
\index{bms.cpp@{bms.cpp}!write\_slaves\_cfg@{write\_slaves\_cfg}}
\index{write\_slaves\_cfg@{write\_slaves\_cfg}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{write\_slaves\_cfg()}{write\_slaves\_cfg()}}
{\footnotesize\ttfamily void write\+\_\+slaves\+\_\+cfg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Write slaves configuration. 

Send through SPI a \char`\"{}\+Write configurazion\char`\"{} broadcast command using initialized config \begin{DoxySeeAlso}{See also}
init\+\_\+slave\+\_\+cfg() 
\end{DoxySeeAlso}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{bms_8cpp_a8da52d3cf3bf83854501719af98ab0e4}\label{bms_8cpp_a8da52d3cf3bf83854501719af98ab0e4}} 
\index{bms.cpp@{bms.cpp}!slaves@{slaves}}
\index{slaves@{slaves}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{slaves}{slaves}}
{\footnotesize\ttfamily \mbox{\hyperlink{struct_slave}{Slave}} slaves\mbox{[}\mbox{\hyperlink{config_8h_a9d3dfaea3b1a9a8e8307c02ce7a0acf0}{SLAVE\+\_\+\+NUM}}\mbox{]}}



\mbox{\hyperlink{struct_slave}{Slave}} array. 

Array where all slaves struct are stored \mbox{\Hypertarget{bms_8cpp_a35ec6d306f657f09635404cb28835f54}\label{bms_8cpp_a35ec6d306f657f09635404cb28835f54}} 
\index{bms.cpp@{bms.cpp}!slaves\_config@{slaves\_config}}
\index{slaves\_config@{slaves\_config}!bms.cpp@{bms.cpp}}
\doxysubsubsection{\texorpdfstring{slaves\_config}{slaves\_config}}
{\footnotesize\ttfamily uint8\+\_\+t slaves\+\_\+config\mbox{[}\mbox{\hyperlink{bms_8h_a8bf6169d30bbeede2c2c0c47ea1bdd83}{CFG\+\_\+\+LEN}}\mbox{]} = \{\}}



\mbox{\hyperlink{struct_slave}{Slave}} configuration. 

Array where slaves configuration are stored 